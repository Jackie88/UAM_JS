angular.module("email-config",[]),angular.module("email-config").controller("ConfigController",function($state,$scope,$rootScope,configService){$scope.$parent.title="Config",$scope.skins=[{value:"default",text:"default"},{value:"green",text:"green"},{value:"yellow",text:"yellow"}],$scope.save_options=function(){configService.setInboxInterval($scope.interval),configService.setSkinVariant($scope.skinVariant),$rootScope.$emit("updateSkin",$scope.skinVariant)};var initialize=function(){$scope.interval=configService.getInboxInterval(),$scope.skinVariant=configService.getSkinVariant()};initialize()}),angular.module("email-config").service("configService",function(localStorageService){var DEFAULT_INTERVAL=1e4,DEFAULT_SKIN="default";this.getInboxInterval=function(){return null!==localStorageService.get("inboxInterval")?localStorageService.get("inboxInterval"):DEFAULT_INTERVAL},this.setInboxInterval=function(interval){localStorageService.set("inboxInterval",parseInt(interval,10))},this.getSkinVariant=function(){return null!==localStorageService.get("skin")?localStorageService.get("skin"):DEFAULT_SKIN},this.setSkinVariant=function(skin){localStorageService.set("skin",skin)}}),angular.module("email-create",[]),angular.module("email-create").controller("CreateController",function($state,$stateParams,$scope,$http){$scope.borders=!1,$scope.$parent.title="Napisz mail",$scope.mailValid=/^((\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*)\s*[,]{0,1}\s*)+$/,""!==$stateParams.emailId&&$http.get("/emails/"+$stateParams.emailId).success(function(data){console.log(data.title),$scope.mailTitle="Re: "+data.title,$scope.receivers=data.sender,$scope.content="\n\n\n"+data.sender+" napisał/a:\n\n"+data.content}),$scope.send=function(){$scope.borders=!0,$scope.NewMail.$valid&&($scope.adr=$scope.receivers.split(","),$http.post("/sent",{id:Date.now(),title:$scope.mailTitle,content:$scope.content,receivers:$scope.adr,sent:Date.now()}).success(function(data){$scope.createSentRes=data,$scope.reset(),$state.go("sent")}))},$scope.reset=function(){$scope.receivers="",$scope.mailTitle="",$scope.content="",$scope.borders=!1}}),angular.module("email-inbox",[]),angular.module("email-inbox").controller("InboxController",function($timeout,$scope,$state,$http,configService){$scope.$parent.title="Odebrane",$scope.reload=$scope.$parent.reloadTime,$scope.emails=[];{var list=element.find("ul");configService.getInboxInterval()}$scope.getData=function(){$http.get("/emails").success(function(data){$scope.emails=data})},$scope.deleteEmail=function(mailId){console.log("usuwam "+mailId),$http["delete"]("/emails/"+mailId,{}).success(function(){$scope.getData()})},$scope.getData(),$scope.intervalFunction=function(){$timeout(function(){$scope.getData(),$scope.intervalFunction()},$scope.reload)},$scope.intervalFunction(),$scope.getMails=setInterval(function(){$scope.getData(),$scope.emails.reverse();for(var id in scope.emails)list.append(prepareEmail(scope.emails[id]))});var prepareEmail=function(email){var listElement=document.createElement("li");listElement.id=email.id;var firstDiv=document.createElement("div");firstDiv.className="emailList";var header=document.createElement("h3");header.innerHTMl="Od: "+email.sender;var title=document.createElement("p");title.innerHTMl="Tytuł: "+email.title;var content=document.createElement("p");content.className="content",header.innerHTMl=email.content.substring(0,60)+"...";var deleteButton=document.createElement("button");deleteButton.id=email.id,deleteButton.bind("click",function(){deleteEmail(email.id)}),deleteButton.innerHTML="Usuń",listElement.appendChild(firstDiv),listElement.appendChild(header),listElement.appendChild(title),listElement.appendChild(content),listElement.appendChild(deleteButton)};$scope.getMails()}),angular.module("email-sent",[]),angular.module("email-sent").controller("SentController",function($scope,$state,$http){$scope.$parent.title="Wysłane",$scope.emails=[],$scope.getData=function(){$http.get("/sent").success(function(data){$scope.emails=data,console.log(data)})},$scope.getDateByTimestamp=function(timeStamp){var date=new Date(timeStamp),months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return date.getDate()+" "+months[date.getMonth()]+" "+date.getFullYear()},$scope.getData()}),function(){var app=angular.module("email-view",[]);app.config(function($stateProvider){$stateProvider.state("respond",{url:"/create/:receviers/:title",controller:"RepsponController"})})}(),angular.module("email-view").controller("ViewController",function($stateParams,$scope,$http,$state){$scope.updateEmail=function(){$http.put("/emails/"+$stateParams.emailId,{read:!0}).success(function(data){$scope.udateEmailRes=data})},$scope.getEmail=function(){$http.get("/emails/"+$stateParams.emailId).success(function(data){$scope.mail=data,$scope.updateEmail(),$scope.getDateByTimestamp(data.received)})},$scope.deleteEmail=function(){$http["delete"]("/emails/"+$stateParams.emailId,{}).success(function(){$state.go("inbox")})},$scope.getDateByTimestamp=function(timeStamp){var date=new Date(timeStamp),months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];$scope.date=date.getDate()+" "+months[date.getMonth()]+" "+date.getFullYear()},$scope.getEmail()}),function(){var app=angular.module("emailApp",["ui.router","email-inbox","email-sent","email-view","email-create","email-config","LocalStorageModule"]);app.controller("mainController",function($scope,$rootScope,configService){$scope.title="Welcome",$scope.reloadTime=31e3;var initialize=function(){var skinLoad=configService.getSkinVariant();$rootScope.skinVariant=skinLoad};initialize(),$rootScope.$on("updateSkin",function(event,skinVariant){$rootScope.skinVariant=skinVariant})}),app.config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/home"),$stateProvider.state("home",{url:"/home",templateUrl:"src/Welcome.html"}).state("view",{url:"/view/:emailId",templateUrl:"src/ViewMail/View.html",controller:"ViewController"}).state("inbox",{url:"/inbox",templateUrl:"src/EmailList/Inbox/Inbox.html",controller:"InboxController"}).state("sent",{url:"/sent",templateUrl:"src/EmailList/Sent/Sent.html",controller:"SentController"}).state("create",{url:"/create/:emailId",templateUrl:"src/Create/Create.html",controller:"CreateController"}).state("config",{url:"/config",templateUrl:"src/Configuration/Config.html",controller:"ConfigController"})})}();